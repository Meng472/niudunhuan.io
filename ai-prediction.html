<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰›é¡¿ç¯æ›²ç‡æµ‹é‡è™šæ‹Ÿä»¿çœŸå®éªŒ - æ•°æ®åˆ†æ</title>
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script>
        window.addEventListener('error', function(event) {
            if (event.filename && event.filename.includes('tfjs') && event.message && event.message.includes('æºæ˜ å°„')) {
                event.preventDefault();
                return true;
            }
        }, true);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0/dist/tf.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="newtonRingSimulator.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                renderActions: {
                    addMenu: [0, '', ''],
                    checkLoading: [0, '', '']
                }
            }
        };
    </script>
    
    <style>
        /* æŒ‰é’®çŠ¶æ€æ ·å¼ */
        .primary-btn, .secondary-btn {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .primary-btn:disabled, .secondary-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .button-success {
            animation: button-success 1s ease;
        }
        
        @keyframes button-success {
            0% { background-color: #4CAF50; }
            70% { background-color: #4CAF50; }
            100% { background-color: #2196F3; }
        }
        
        /* ä¸»æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .primary-btn:hover:not(:disabled) {
            background-color: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* æ¬¡è¦æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .secondary-btn:hover:not(:disabled) {
            background-color: #e0e0e0;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .primary-btn:active:not(:disabled), .secondary-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* åŠ è½½çŠ¶æ€æ—‹è½¬åŠ¨ç”» */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æ·»åŠ åé¦ˆæ³¢çº¹æ•ˆæœ */
        .primary-btn::after, .secondary-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%, -50%);
            transform-origin: 50% 50%;
        }
        
        .primary-btn:focus:not(:active)::after, 
        .secondary-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.3;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }
        
        .prediction-actions {
            text-align: center;
            margin-bottom: 20px;
        }
        #new-predict-btn {
            padding: 10px 20px;
            font-size: 1.1em;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .combined-data-view {
            width: 95%;
            margin: 0 auto 20px auto;
        }
        .combined-chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        .chart-controls {
            display: flex;
            gap: 8px;
        }
        .results-panel {
            display: flex;
            justify-content: space-around;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            border: 1px solid #eee;
        }
        .result-column {
            flex: 1;
            min-width: 200px;
            padding: 0 15px;
            text-align: left;
        }
        .result-column h4 {
            margin-top: 0;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
            margin-bottom: 12px;
            color: #333;
            font-size: 1.1em;
        }
        .result-column p {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            font-size: 0.95em;
        }
        .result-column p span {
            font-weight: bold;
            color: #1976D2;
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-link" style="position: absolute; left: 20px; top: 20px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            è¿”å›é¦–é¡µ
        </a>
        <h1>ç‰›é¡¿ç¯æ›²ç‡æµ‹é‡è™šæ‹Ÿä»¿çœŸå®éªŒ</h1>
    </header>
    
    <main>
        <div class="tabs">
            <a href="theory.html" class="tab-btn" style="text-decoration: none;">å®éªŒåŸç†</a>
            <a href="3d-demo.html" class="tab-btn" style="text-decoration: none;">3Då®éªŒæ¼”ç¤º</a>
            <a href="simulation.html" class="tab-btn" style="text-decoration: none;">ä»¿çœŸå®éªŒ</a>
            <a href="ai-prediction.html" class="tab-btn active" style="text-decoration: none;">æ•°æ®åˆ†æ</a>
            <a href="extension.html" class="tab-btn" style="text-decoration: none;">æ‹“å±•å†…å®¹</a>
            <a href="ideological-education.html" class="tab-btn" style="text-decoration: none;">æ ¼ç‰©è‡´çŸ¥</a>
        </div>
        
        <div class="tab-content">
            <!-- æ•°æ®åˆ†æå’Œè®¨è®º -->
            <div id="ai-prediction" class="tab-pane active">
                <div class="theory-panel">
                    <h3>ä»¿çœŸè®¡ç®—æ ¸å¿ƒä¸æ•°æ®åˆ†æ</h3>
                    <div class="theory-content">
                        <p>æ¬¢è¿æ¥åˆ°ç‰›é¡¿ç¯äº¤äº’å¼ä»¿çœŸæ¨¡å—ã€‚æœ¬æ¨¡å—çš„æ ¸å¿ƒæ˜¯ <code>newtonRingSimulator.js</code> è®¡ç®—å¼•æ“ï¼Œå®ƒèƒ½æ¨¡æ‹Ÿç”Ÿæˆç‰›é¡¿ç¯å¹²æ¶‰æ•°æ®ï¼Œå¹¶è¿ç”¨çº¿æ€§å›å½’è¿›è¡Œæ‹Ÿåˆï¼Œç²¾ç¡®è®¡ç®—æ›²ç‡åŠå¾„ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒæ•´æ›²ç‡åŠå¾„ã€æ³¢é•¿å’Œå™ªå£°æ°´å¹³ç­‰å‚æ•°ï¼Œå®æ—¶è§‚å¯Ÿå…¶å¯¹æµ‹é‡ç»“æœçš„å½±å“ã€‚æˆ‘ä»¬é¼“åŠ±æ‚¨æ¢ç´¢å¹¶ä¿®æ”¹è„šæœ¬ï¼Œä»¥æ·±åŒ–å¯¹ç‰©ç†æ¨¡å‹å’Œæ•°æ®å¤„ç†çš„ç†è§£ã€‚</p>
                    </div>
                </div>
                
                <div class="prediction-comparison">
                    <div class="prediction-actions">
                        <button id="new-predict-btn" class="primary-btn">è¿è¡Œæ•°æ®åˆ†æ</button>
                    </div>
                    <div class="combined-data-view">
                        <div class="chart-header">
                            <h3>ç‰›é¡¿ç¯æ›²ç‡åŠå¾„åˆ†æç»“æœ</h3>
                        </div>
                        <div class="combined-chart-container">
                            <canvas id="combined-chart"></canvas>
                        </div>
                        <div class="results-panel">
                            <div class="result-column">
                                <h4>ä»¿çœŸé‡‡é›†æ•°æ®</h4>
                                <p>çœŸå®åŠå¾„: <span id="actual-radius">-- mm</span></p>
                                <p>æ•°æ®ç‚¹æ•°: <span id="actual-points">--</span></p>
                                <p>æ ‡å‡†å·®: <span id="actual-std-dev">--</span></p>
                            </div>
                            <div class="result-column">
                                <h4>æ¨¡å‹é¢„æµ‹ç»“æœ</h4>
                                <p>é¢„æµ‹åŠå¾„: <span id="predicted-radius">-- mm</span></p>
                                <p>é¢„æµ‹æ—¶é—´: <span id="prediction-time">-- ms</span></p>
                                <p>ç›¸å¯¹è¯¯å·®: <span id="relative-error">--%</span></p>
                            </div>
                            <div class="result-column">
                                <h4>æ‹Ÿåˆç»“æœ</h4>
                                <p>æ‹Ÿåˆæ–œç‡: <span id="fit-slope">-- mmÂ²/ç¯</span></p>
                                <p>æ‹Ÿåˆä¼˜åº¦: <span id="r-squared">--</span></p>
                                <p>ç½®ä¿¡åŒºé—´: <span id="confidence-interval">Â±--%</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="interactive-analysis">
                    <h3>äº¤äº’å¼æ•°æ®æ¢ç´¢</h3>
                    <div class="analysis-tabs">
                        <div class="analysis-tab active" data-tab="basic-analysis">åŸºç¡€åˆ†æ</div>
                        <div class="analysis-tab" data-tab="radius-analysis">åŠå¾„åˆ†æ</div>
                        <div class="analysis-tab" data-tab="wavelength-analysis">æ³¢é•¿åˆ†æ</div>
                        <div class="analysis-tab" data-tab="error-analysis">è¯¯å·®åˆ†æ</div>
                    </div>
                    <div class="analysis-content">
                        <div id="basic-analysis" class="analysis-pane active">
                            <p class="analysis-description">æ¢ç´¢ç‰›é¡¿ç¯å®éªŒæ•°æ®çš„åŸºæœ¬å±æ€§å’Œå…³ç³»</p>
                            <div class="simple-controls">
                                <div class="control-row">
                                    <button id="plot-data" class="primary-btn">ç»˜åˆ¶æ•°æ®å›¾è¡¨</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="basic-chart"></canvas>
                            </div>
                            <div class="analysis-info">
                                <h4>åŸºæœ¬æ•°æ®ç»Ÿè®¡</h4>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-label">æ•°æ®ç‚¹æ•°:</div>
                                        <div class="stat-value" id="data-count">--</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">æ‹Ÿåˆæ–œç‡:</div>
                                        <div class="stat-value" id="basic-fit-slope">-- mmÂ²/ç¯</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">è®¡ç®—æ›²ç‡åŠå¾„:</div>
                                        <div class="stat-value" id="calc-radius">-- mm</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">æµ‹é‡ç²¾åº¦:</div>
                                        <div class="stat-value" id="measure-precision">--%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="radius-analysis" class="analysis-pane">
                            <p class="analysis-description">åˆ†ææ›²ç‡åŠå¾„å¯¹æµ‹é‡ç»“æœçš„å½±å“</p>
                            <div class="parameter-control">
                                <label for="radius-slider">æµ‹è¯•æ›²ç‡åŠå¾„ (mm):</label>
                                <input type="range" id="radius-slider" min="50" max="300" value="150" step="1">
                                <span id="radius-value">150 mm</span>
                                <button id="apply-radius" class="secondary-btn">åº”ç”¨</button>
                            </div>
                            <div class="chart-container">
                                <canvas id="radius-chart"></canvas>
                            </div>
                            <div class="radius-insights">
                                <div class="insight-card">
                                    <h4>åŠå¾„å˜åŒ–åˆ†æ</h4>
                                    <p>æ›²ç‡åŠå¾„å˜å¤§æ—¶ï¼Œç¯é—´è·å˜å°ï¼Œä½†ç¯æ•°å¢å¤šã€‚è¿™æ˜¯å› ä¸ºæ›²ç‡åŠå¾„å¢å¤§å¯¼è‡´ç©ºæ°”è–„è†œåšåº¦å˜åŒ–ç‡é™ä½ï¼Œä½¿ç›¸é‚»ç¯ä¹‹é—´çš„åšåº¦å·®å‡å°ã€‚</p>
                                    <p>å½“å‰é…ç½®ä¸‹çš„ç¯æ•°é¢„ä¼°: <span id="ring-count">--</span></p>
                                    <p>ç¬¬5ç¯ç›´å¾„é¢„ä¼°: <span id="ring-diameter">--</span> mm</p>
                                </div>
                            </div>
                        </div>
                        
                        <div id="wavelength-analysis" class="analysis-pane">
                            <p class="analysis-description">æ¢ç´¢ä¸åŒæ³¢é•¿å¯¹ç‰›é¡¿ç¯å¹²æ¶‰å›¾æ¡ˆçš„å½±å“</p>
                            <div class="wavelength-selection">
                                <div class="selection-row">
                                    <button class="wavelength-btn" data-wavelength="450" style="background-color: rgba(0, 0, 255, 0.7);">
                                        <div class="color-indicator" style="background-color: #0000FF;"></div>
                                        <span>è“å…‰ (450nm)</span>
                                    </button>
                                    <button class="wavelength-btn" data-wavelength="550" style="background-color: rgba(0, 255, 0, 0.5);">
                                        <div class="color-indicator" style="background-color: #00FF00;"></div>
                                        <span>ç»¿å…‰ (550nm)</span>
                                    </button>
                                    <button class="wavelength-btn active" data-wavelength="589" style="background-color: rgba(255, 255, 0, 0.5);">
                                        <div class="color-indicator" style="background-color: #FFFF00;"></div>
                                        <span>é»„å…‰ (589nm)</span>
                                    </button>
                                    <button class="wavelength-btn" data-wavelength="650" style="background-color: rgba(255, 0, 0, 0.7);">
                                        <div class="color-indicator" style="background-color: #FF0000;"></div>
                                        <span>çº¢å…‰ (650nm)</span>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="wavelength-chart"></canvas>
                            </div>
                            <div class="wavelength-comparison">
                                <table class="comparison-table">
                                    <thead>
                                        <tr>
                                            <th>æ³¢é•¿ (nm)</th>
                                            <th>1ç¯ç›´å¾„ (mm)</th>
                                            <th>5ç¯ç›´å¾„ (mm)</th>
                                            <th>ç›¸å¯¹ç²¾åº¦</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>450</td>
                                            <td id="d1-450">--</td>
                                            <td id="d5-450">--</td>
                                            <td id="p-450">--</td>
                                        </tr>
                                        <tr>
                                            <td>550</td>
                                            <td id="d1-550">--</td>
                                            <td id="d5-550">--</td>
                                            <td id="p-550">--</td>
                                        </tr>
                                        <tr>
                                            <td>589</td>
                                            <td id="d1-589">--</td>
                                            <td id="d5-589">--</td>
                                            <td id="p-589">--</td>
                                        </tr>
                                        <tr>
                                            <td>650</td>
                                            <td id="d1-650">--</td>
                                            <td id="d5-650">--</td>
                                            <td id="p-650">--</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="wavelength-note">
                                <p><i class="note-icon">ğŸ“</i> è¾ƒçŸ­çš„æ³¢é•¿ä¼šäº§ç”Ÿæ›´å¯†é›†çš„å¹²æ¶‰æ¡çº¹ï¼Œç†è®ºä¸Šå¯ä»¥æé«˜æµ‹é‡ç²¾åº¦ï¼Œä½†ä¹Ÿå¢åŠ äº†åŒºåˆ†ç›¸é‚»ç¯çš„éš¾åº¦ã€‚</p>
                            </div>
                        </div>
                        
                        <div id="error-analysis" class="analysis-pane">
                            <div class="error-analysis-description">
                                <h3>è¯¯å·®å½±å“æ¨¡æ‹Ÿ</h3>
                                <p>é€‰æ‹©ä¸åŒç±»å‹çš„è¯¯å·®ï¼Œè°ƒæ•´è¯¯å·®å¹…åº¦ï¼Œè§‚å¯Ÿå®ƒä»¬å¯¹æ›²ç‡åŠå¾„æµ‹é‡ç»“æœçš„å½±å“ã€‚</p>
                            </div>
                            
                            <div class="error-categories">
                                <div class="error-category-card systematic">
                                    <div class="error-category-header">
                                        <h4>ç³»ç»Ÿè¯¯å·®</h4>
                                        <div class="error-percentage" id="systematic-error-percentage">65%</div>
                                    </div>
                                    <div class="error-category-body">
                                        <p>ç³»ç»Ÿè¯¯å·®æ˜¯ç”±å®éªŒè£…ç½®æˆ–æµ‹é‡æ–¹æ³•çš„å›ºæœ‰ç¼ºé™·å¯¼è‡´çš„ï¼Œå®ƒä»¬å…·æœ‰ä¸€å®šçš„è§„å¾‹æ€§ï¼Œå¯é€šè¿‡æ ¡å‡†æˆ–è¡¥å¿éƒ¨åˆ†æ¶ˆé™¤ã€‚</p>
                                        <div class="error-cards">
                                            <div class="error-card">
                                                <h5>é€é•œæ¥è§¦é—®é¢˜</h5>
                                                <p>å¹³å‡¸é€é•œä¸å¹³é¢ç»ç’ƒçš„æ¥è§¦ç‚¹å¯èƒ½å­˜åœ¨å¾®å°æ°”éš™ï¼Œå¯¼è‡´èµ·å§‹ç¯ä½ç½®åˆ¤æ–­è¯¯å·®ã€‚</p>
                                            </div>
                                            <div class="error-card">
                                                <h5>é€é•œè¡¨é¢é—®é¢˜</h5>
                                                <p>å¹³å‡¸é€é•œæˆ–å¹³é¢ç»ç’ƒè¡¨é¢å¯èƒ½å­˜åœ¨å¾®å°åˆ’ç—•æˆ–ä¸å‡åŒ€æ€§ã€‚</p>
                                            </div>
                                            <div class="error-card">
                                                <h5>å…‰æºé—®é¢˜</h5>
                                                <p>å…‰æºçš„éå•è‰²æ€§å¯¼è‡´å¹²æ¶‰ç¯è¾¹ç¼˜ä¸å¤Ÿæ¸…æ™°ï¼Œå½±å“æµ‹é‡ç²¾åº¦ã€‚</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="error-category-card random">
                                    <div class="error-category-header">
                                        <h4>éšæœºè¯¯å·®</h4>
                                        <div class="error-percentage" id="random-error-percentage">35%</div>
                                    </div>
                                    <div class="error-category-body">
                                        <p>éšæœºè¯¯å·®ç”±å¤šç§ä¸ç¡®å®šå› ç´ å¼•èµ·ï¼Œå®ƒä»¬çš„å¤§å°å’Œæ–¹å‘æ˜¯éšæœºçš„ï¼Œå¯é€šè¿‡å¤šæ¬¡æµ‹é‡å’Œç»Ÿè®¡æ–¹æ³•å‡å°å…¶å½±å“ã€‚</p>
                                        <div class="error-cards">
                                            <div class="error-card">
                                                <h5>ä¸»è§‚åˆ¤æ–­</h5>
                                                <p>ä¸åŒè§‚å¯Ÿè€…å¯¹å¹²æ¶‰ç¯ä½ç½®çš„åˆ¤æ–­å­˜åœ¨å·®å¼‚ã€‚</p>
                                            </div>
                                            <div class="error-card">
                                                <h5>è¯»æ•°è¯¯å·®</h5>
                                                <p>æµ‹é‡å·¥å…·çš„ç²¾åº¦é™åˆ¶åŠä½¿ç”¨è€…è¯»æ•°è¿‡ç¨‹ä¸­å¼•å…¥çš„è¯¯å·®ã€‚</p>
                                            </div>
                                            <div class="error-card">
                                                <h5>ç¯å¢ƒå› ç´ </h5>
                                                <p>æ¸©åº¦ã€æ¹¿åº¦ã€æŒ¯åŠ¨ç­‰ç¯å¢ƒå› ç´ å¯¹å®éªŒè¿‡ç¨‹çš„å¹²æ‰°ã€‚</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="simulation-controls">
                                <div class="control-group">
                                    <label for="error-type-select">è¯¯å·®ç±»å‹:</label>
                                    <select id="error-type-select">
                                        <option value="contact">é€é•œæ¥è§¦é—®é¢˜</option>
                                        <option value="surface">é€é•œè¡¨é¢é—®é¢˜</option>
                                        <option value="light">å…‰æºé—®é¢˜</option>
                                        <option value="reading">è¯»æ•°è¯¯å·®</option>
                                        <option value="judgment">ä¸»è§‚åˆ¤æ–­</option>
                                    </select>
                                </div>
                                
                                <div class="control-group">
                                    <label for="error-magnitude">è¯¯å·®å¹…åº¦:</label>
                                    <input type="range" id="error-magnitude" min="1" max="10" value="5" step="0.5">
                                    <span id="error-magnitude-value">5%</span>
                                </div>
                                
                                <button id="calculate-error-effect" class="primary-button">è®¡ç®—è¯¯å·®å½±å“</button>
                            </div>
                            
                            <div class="simulation-result">
                                <div class="chart-container">
                                    <canvas id="error-impact-chart"></canvas>
                                </div>
                                
                                <div class="result-table">
                                    <h4>ä¸åŒè¯¯å·®ç±»å‹çš„å½±å“</h4>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>è¯¯å·®ç±»å‹</th>
                                                <th>å¯¹æ›²ç‡åŠå¾„çš„å½±å“</th>
                                                <th>ç›¸å¯¹è¯¯å·®</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>é€é•œæ¥è§¦é—®é¢˜</td>
                                                <td id="contact-impact">Â±6.0 mm</td>
                                                <td id="contact-relative">6.0%</td>
                                            </tr>
                                            <tr>
                                                <td>é€é•œè¡¨é¢é—®é¢˜</td>
                                                <td id="surface-impact">Â±4.5 mm</td>
                                                <td id="surface-relative">4.5%</td>
                                            </tr>
                                            <tr>
                                                <td>å…‰æºé—®é¢˜</td>
                                                <td id="light-impact">Â±3.0 mm</td>
                                                <td id="light-relative">3.0%</td>
                                            </tr>
                                            <tr>
                                                <td>è¯»æ•°è¯¯å·®</td>
                                                <td id="reading-impact">Â±2.0 mm</td>
                                                <td id="reading-relative">2.0%</td>
                                            </tr>
                                            <tr>
                                                <td>ä¸»è§‚åˆ¤æ–­</td>
                                                <td id="judgment-impact">Â±1.2 mm</td>
                                                <td id="judgment-relative">1.2%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="error-methods-panel">
                                <h3>è¯¯å·®å¤„ç†æ–¹æ³•</h3>
                                <div class="method-cards">
                                    <div class="method-card">
                                        <div class="method-icon">1</div>
                                        <div class="method-content">
                                            <h4>çº¿æ€§å›å½’åˆ†æ</h4>
                                            <p>é‡‡ç”¨æœ€å°äºŒä¹˜æ³•æ‹ŸåˆDÂ²ä¸mçš„çº¿æ€§å…³ç³»ï¼Œå‡å°éšæœºè¯¯å·®å½±å“ã€‚</p>
                                        </div>
                                    </div>
                                    <div class="method-card">
                                        <div class="method-icon">2</div>
                                        <div class="method-content">
                                            <h4>é€‰æ‹©å¤–ç¯æµ‹é‡</h4>
                                            <p>ä¼˜å…ˆé€‰æ‹©è¾ƒå¤–ä¾§çš„å¹²æ¶‰ç¯è¿›è¡Œæµ‹é‡ï¼Œå‡å°ä¸­å¿ƒåˆ¤æ–­ä¸å‡†ç¡®å¸¦æ¥çš„å½±å“ã€‚</p>
                                        </div>
                                    </div>
                                    <div class="method-card">
                                        <div class="method-icon">3</div>
                                        <div class="method-content">
                                            <h4>é‡å¤æµ‹é‡æ³•</h4>
                                            <p>å¯¹åŒä¸€å¹²æ¶‰ç¯è¿›è¡Œå¤šæ¬¡æµ‹é‡ï¼Œå–å¹³å‡å€¼å‡å°éšæœºè¯¯å·®ã€‚</p>
                                        </div>
                                    </div>
                                    <div class="method-card">
                                        <div class="method-icon">4</div>
                                        <div class="method-content">
                                            <h4>æ ‡å‡†å·®è®¡ç®—</h4>
                                            <p>è®¡ç®—å¤šæ¬¡æµ‹é‡ç»“æœçš„æ ‡å‡†å·®ï¼Œè¯„ä¼°æµ‹é‡ç²¾åº¦ã€‚</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>Â© 2025 AIæ™ºèƒ½ä½“å¢å¼ºçš„ç‰›é¡¿ç¯æ›²ç‡æµ‹é‡è™šæ‹Ÿä»¿çœŸå®éªŒå¹³å°</p>
    </footer>
    
    <!-- å®éªŒæŠ¥å‘Šé¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="report-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>å®éªŒæŠ¥å‘Šé¢„è§ˆ</h2>
                <span class="report-close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="report-content" class="report-content"></div>
            </div>
            <div class="modal-footer">
                <button id="modal-print-btn" class="report-btn print-btn" onclick="printReport()">æ‰“å°æŠ¥å‘Š</button>
                <button id="modal-download-btn" class="report-btn download-btn" onclick="downloadReport()">ä¸‹è½½æŠ¥å‘Š</button>
                <button id="modal-close-btn" class="report-btn close-btn" onclick="document.getElementById('report-modal').style.display='none'">å…³é—­é¢„è§ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- ä¸Šåˆ’æŒ‰é’® -->
    <div class="scroll-to-top" id="scrollToTop">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 19V5M12 5L5 12M12 5L19 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>

    <script src="app.js"></script>
    <script src="simulation.js"></script>
    <script src="3d-demo.js"></script>
    <script src="ai-model.js"></script>
    <script>
        // åˆå§‹åŒ–å¿…è¦çš„å…¨å±€å˜é‡
        window.elements = {
            // æ§åˆ¶å…ƒç´ 
            testRadius: { value: "100" },
            testWavelength: { value: "589" },
            noiseLevel: { value: "2" },
            sampleCount: { value: "15" },
            confidenceLevel: { value: "0.95" },
            analysisMethod: { value: "least-squares" },
            
            // æŒ‰é’®å…ƒç´ 
            predictBtn: document.getElementById('new-predict-btn'),
            
            // çŠ¶æ€å’Œç»“æœæ˜¾ç¤ºå…ƒç´ 
            modelStatus: { textContent: "" },
            confidenceInterval: document.getElementById('confidence-interval'),
            predictedRadius: document.getElementById('predicted-radius'),
            predictionTime: document.getElementById('prediction-time'),
            fitSlope: document.getElementById('fit-slope'),
            actualRadius: document.getElementById('actual-radius'),
            relativeError: document.getElementById('relative-error')
        };
        
        // åˆå§‹åŒ–å›¾è¡¨å¯¹è±¡
        window.charts = {
            predictionChart: null,
            actualChart: null
        };
        
        // çº¿æ€§å›å½’å‡½æ•°
        function linearRegression(data) {
            const n = data.length;
            if (n < 2) return { slope: 0, intercept: 0, r2: 0 };

            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
            for (const point of data) {
                sumX += point.x;
                sumY += point.y;
                sumXY += point.x * point.y;
                sumX2 += point.x * point.x;
            }
            const x_mean = sumX / n;
            const y_mean = sumY / n;

            let ss_tot = 0, ss_res = 0;
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = y_mean - slope * x_mean;

            for (const point of data) {
                ss_tot += Math.pow(point.y - y_mean, 2);
                ss_res += Math.pow(point.y - (slope * point.x + intercept), 2);
            }
            
            const r2 = ss_tot === 0 ? 1 : 1 - (ss_res / ss_tot);
            return { slope, intercept, r2 };
        }
        
        // è®¡ç®—æ ‡å‡†è¯¯å·®
        function calculateStandardError(data, regression) {
            if (data.length <= 2) return 0;
            
            const n = data.length;
            let sum_squared_residuals = 0;
            let sum_x_squared = 0;
            let mean_x = 0;
            
            // è®¡ç®—xçš„å¹³å‡å€¼
            for (const point of data) {
                mean_x += point.x;
            }
            mean_x /= n;
            
            // è®¡ç®—æ®‹å·®å¹³æ–¹å’Œå’Œxå¹³æ–¹å’Œ
            for (const point of data) {
                const predicted_y = regression.slope * point.x + regression.intercept;
                sum_squared_residuals += Math.pow(point.y - predicted_y, 2);
                sum_x_squared += Math.pow(point.x - mean_x, 2);
            }
            
            // è®¡ç®—æ ‡å‡†è¯¯å·®
            const variance = sum_squared_residuals / (n - 2);
            const standard_error = Math.sqrt(variance / sum_x_squared);
            
            return standard_error;
        }
        
        // è·å–ç½®ä¿¡åŒºé—´tå€¼
        function getConfidenceT(confidence, df) {
            // ç®€åŒ–çš„tåˆ†å¸ƒä¸´ç•Œå€¼æŸ¥æ‰¾
            const t_table = {
                "0.9": { // 90%ç½®ä¿¡æ°´å¹³
                    5: 2.015, 10: 1.812, 15: 1.753, 20: 1.725
                },
                "0.95": { // 95%ç½®ä¿¡æ°´å¹³
                    5: 2.571, 10: 2.228, 15: 2.131, 20: 2.086
                },
                "0.99": { // 99%ç½®ä¿¡æ°´å¹³
                    5: 4.032, 10: 3.169, 15: 2.947, 20: 2.845
                }
            };
            
            // æŸ¥æ‰¾æœ€æ¥è¿‘çš„è‡ªç”±åº¦
            let closest_df = Object.keys(t_table[confidence]).reduce((prev, curr) => {
                return (Math.abs(curr - df) < Math.abs(prev - df) ? curr : prev);
            });
            
            return t_table[confidence][closest_df];
        }
        
        // å¼€å§‹é¢„æµ‹è®¡ç®—å‡½æ•°
        function startPrediction() {
            try {
                console.log("å¼€å§‹æ•°æ®åˆ†æè®¡ç®—...");
                
                const startTime = performance.now();
                
                // è·å–å‚æ•°
                const R_actual = parseFloat(elements.testRadius.value); // mm
                const lambda = parseFloat(elements.testWavelength.value) * 1e-6; // mm
                const noisePercent = parseFloat(elements.noiseLevel.value);
                const numSamples = parseInt(elements.sampleCount.value);
                
                console.log("å‚æ•°:", {R_actual, lambda, noisePercent, numSamples});
                
                // æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§
                if (isNaN(R_actual) || isNaN(lambda) || isNaN(noisePercent) || isNaN(numSamples)) {
                    throw new Error("æ— æ•ˆçš„è¾“å…¥å‚æ•°");
                }
                
                // ç”Ÿæˆç†æƒ³æ•°æ®
                let actualData = [];
                for (let m = 1; m <= numSamples; m++) {
                    const D_m_sq = 4 * m * lambda * R_actual;
                    actualData.push({ x: m, y: D_m_sq });
                }
                console.log("ç†æƒ³æ•°æ®:", actualData);
                
                // æ·»åŠ å™ªå£°ç”Ÿæˆæµ‹é‡æ•°æ®
                let measuredData = actualData.map(p => {
                    const noise = (Math.random() - 0.5) * 2 * p.y * (noisePercent / 100);
                    return { x: p.x, y: p.y + noise };
                });
                console.log("æµ‹é‡æ•°æ®:", measuredData);
                
                // çº¿æ€§å›å½’
                const regression = linearRegression(measuredData);
                console.log("å›å½’ç»“æœ:", regression);
                
                // è®¡ç®—é¢„æµ‹åŠå¾„
                const R_predicted = regression.slope / (4 * lambda);
                console.log("é¢„æµ‹åŠå¾„:", R_predicted);
                
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(1);
                
                // è®¡ç®—ç½®ä¿¡åŒºé—´
                const confidenceValue = parseFloat(elements.confidenceLevel.value);
                const t_value = getConfidenceT(confidenceValue, numSamples - 2);
                const standard_error = calculateStandardError(measuredData, regression);
                const confidence_interval = (t_value * standard_error / (4 * lambda)).toFixed(2);
                
                // æ›´æ–°UI
                updateUI(R_actual, R_predicted, duration, regression, actualData, measuredData);
                
                if (elements.confidenceInterval) {
                    elements.confidenceInterval.textContent = `Â±${confidence_interval} mm`;
                }
                
                console.log("è®¡ç®—å®Œæˆ");
                
            } catch (error) {
                console.error("è®¡ç®—å¤±è´¥:", error);
                alert(`è®¡ç®—å‡ºé”™ï¼š\n${error.message}\nè¯·æ£€æŸ¥å‚æ•°æˆ–åˆ·æ–°é¡µé¢é‡è¯•ã€‚`);
            }
        }
        
        // ä¸ºai-prediction.htmlé¡µé¢é‡æ–°å®šä¹‰initializeChartså‡½æ•°
        window.initializeCharts = function() {
            const combinedChartCanvas = document.getElementById('combined-chart');
            if (!combinedChartCanvas) return;
            
            // æ¸…é™¤å·²æœ‰å›¾è¡¨
            const existingChart = Chart.getChart(combinedChartCanvas);
            if (existingChart) {
                existingChart.destroy();
            }
            
            // åˆ›å»ºæ–°çš„ç»„åˆå›¾è¡¨
            window.combinedChart = new Chart(combinedChartCanvas.getContext('2d'), {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'ä»¿çœŸé‡‡é›†æ•°æ®',
                            data: [],
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            pointRadius: 5
                        },
                        {
                            label: 'ä»¿çœŸæ•°æ®æ‹Ÿåˆçº¿',
                            data: [],
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            fill: false
                        },
                        {
                            label: 'æ¨¡å‹é¢„æµ‹',
                            data: [],
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            pointRadius: 5
                        },
                        {
                            label: 'æ¨¡å‹é¢„æµ‹æ‹Ÿåˆçº¿',
                            data: [],
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            showLine: true,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#333'
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ç¯åº (m)',
                                color: '#333'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç¯å¾„å¹³æ–¹ (DÂ²â‚˜, mmÂ²)',
                                color: '#333'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
            
            // å°†ç»„åˆå›¾è¡¨èµ‹å€¼ç»™chartså¯¹è±¡
            charts.predictionChart = window.combinedChart;
            charts.actualChart = window.combinedChart;
        };
        
        // æ›´æ–°UIå‡½æ•°ï¼Œæ·»åŠ æ¨¡å‹é¢„æµ‹æ•°æ®
        window.updateUI = function(R_actual, R_predicted, duration, regression, actualData, measuredData) {
            try {
                // æ›´æ–°ç»“æœæ˜¾ç¤º
                if (elements.predictedRadius) elements.predictedRadius.textContent = `${R_predicted.toFixed(2)} mm`;
                if (elements.predictionTime) elements.predictionTime.textContent = `${duration} ms`;
                if (elements.fitSlope) elements.fitSlope.textContent = `${regression.slope.toExponential(4)} mmÂ²/ç¯`;
                if (elements.actualRadius) elements.actualRadius.textContent = `${R_actual.toFixed(2)} mm`;
                if(document.getElementById('actual-points')) document.getElementById('actual-points').textContent = measuredData.length;
                if(document.getElementById('r-squared')) document.getElementById('r-squared').textContent = regression.r2.toFixed(4);

                // è®¡ç®—ç›¸å¯¹è¯¯å·®
                const relativeError = ((Math.abs(R_predicted - R_actual) / R_actual) * 100).toFixed(2);
                if (elements.relativeError) elements.relativeError.textContent = `${relativeError}%`;
                
                // æ›´æ–°å›¾è¡¨
                if (window.combinedChart) {
                    const fitLineData = [];
                    const xMin = 0;
                    const xMax = Math.max(...measuredData.map(p => p.x)) + 1;
                    for (let x = xMin; x <= xMax; x += 0.5) {
                        fitLineData.push({ x: x, y: regression.slope * x + regression.intercept });
                    }
                    
                    // åˆ›å»ºæ¨¡å‹é¢„æµ‹æ•°æ®ï¼ˆä¸æµ‹é‡æ•°æ®ç›¸åŒï¼Œä½†å¯èƒ½æœ‰ä¸åŒçš„å™ªå£°ï¼‰
                    const modelPredictData = actualData.map(p => {
                        const noise = (Math.random() - 0.5) * 2 * p.y * (1 / 100); // ä½¿ç”¨1%çš„å™ªå£°
                        return { x: p.x, y: p.y + noise };
                    });
                    
                    // ä¸ºæ¨¡å‹é¢„æµ‹æ•°æ®åˆ›å»ºæ‹Ÿåˆçº¿
                    const modelRegression = linearRegression(modelPredictData);
                    const modelFitLineData = [];
                    for (let x = xMin; x <= xMax; x += 0.5) {
                        modelFitLineData.push({ x: x, y: modelRegression.slope * x + modelRegression.intercept });
                    }
                    
                    window.combinedChart.data.datasets[0].data = measuredData;
                    window.combinedChart.data.datasets[1].data = fitLineData;
                    window.combinedChart.data.datasets[2].data = modelPredictData;
                    window.combinedChart.data.datasets[3].data = modelFitLineData;
                    
                    window.combinedChart.update();
                    
                    // ä¿å­˜æ•°æ®ä»¥ä¾›äº¤äº’å¼åˆ†æä½¿ç”¨
                    window.analysisData = {
                        actualData,
                        measuredData,
                        modelPredictData,
                        regression,
                        modelRegression,
                        R_actual,
                        R_predicted
                    };
                }
            } catch (e) {
                console.error("æ›´æ–°UIæ—¶å‡ºé”™:", e);
                alert("æ›´æ–°ç•Œé¢æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚");
            }
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            // ç¡®ä¿ DOM å®Œå…¨åŠ è½½
            
            // 1. åˆå§‹åŒ–å›¾è¡¨
            if (typeof initializeCharts === 'function') {
                initializeCharts();
            } else {
                console.error("initializeCharts å‡½æ•°æœªå®šä¹‰!");
                return;
            }

            // 2. ç»‘å®šæŒ‰é’®äº‹ä»¶
            const newPredictBtn = document.getElementById('new-predict-btn');
            if (newPredictBtn) {
                window.elements.predictBtn = newPredictBtn; // æ›´æ–°å…¨å±€å¼•ç”¨
                
                if (typeof startPrediction === 'function') {
                    newPredictBtn.addEventListener('click', startPrediction);
                } else {
                    console.error("startPrediction å‡½æ•°æœªå®šä¹‰!");
                }
            }
            
            // 3. å»¶è¿Ÿåè‡ªåŠ¨è¿è¡Œä¸€æ¬¡åˆ†æ
            setTimeout(() => {
                if (typeof startPrediction === 'function') {
                    startPrediction();
                }
            }, 500); // å»¶è¿Ÿä»¥ç¡®ä¿å›¾è¡¨åŠ¨ç”»æ¸²æŸ“å®Œæˆ
        
            // ç»‘å®šäº¤äº’å¼åˆ†ææ ‡ç­¾åˆ‡æ¢äº‹ä»¶
            const analysisTabs = document.querySelectorAll('.analysis-tab');
            analysisTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    analysisTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const panes = document.querySelectorAll('.analysis-pane');
                    panes.forEach(pane => pane.classList.remove('active'));
                    const currentPane = document.getElementById(tabId);
                    if (currentPane) {
                        currentPane.classList.add('active');
                    }
                });
            });
            
            // ç»‘å®šåŸºç¡€åˆ†ææŒ‰é’®äº‹ä»¶
            const plotDataBtn = document.getElementById('plot-data');
            if (plotDataBtn) {
                plotDataBtn.addEventListener('click', plotData);
            }
            
            // ç»‘å®šåŠå¾„åˆ†ææ»‘å—äº‹ä»¶
            const radiusSlider = document.getElementById('radius-slider');
            const applyRadiusBtn = document.getElementById('apply-radius');
            if (radiusSlider && applyRadiusBtn) {
                radiusSlider.addEventListener('input', function() {
                    document.getElementById('radius-value').textContent = `${this.value} mm`;
                });
                
                applyRadiusBtn.addEventListener('click', function() {
                    updateRadiusAnalysis(parseFloat(radiusSlider.value));
                });
            }
            
            // ç»‘å®šæ³¢é•¿åˆ†ææŒ‰é’®äº‹ä»¶
            const wavelengthBtns = document.querySelectorAll('.wavelength-btn');
            wavelengthBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const wavelength = parseInt(this.getAttribute('data-wavelength'));
                    wavelengthBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateWavelengthAnalysis(wavelength);
                });
            });
            
            // ç»‘å®šè¯¯å·®åˆ†ææŒ‰é’®äº‹ä»¶
            const calculateErrorBtn = document.getElementById('calculate-error-effect');
            if (calculateErrorBtn) {
                calculateErrorBtn.addEventListener('click', calculateErrorEffect);
            }
            
            // åˆå§‹åŒ–å„ä¸ªåˆ†ææ¨¡å—
            initBasicAnalysis();
            initRadiusAnalysis();
            initWavelengthAnalysis();
            initErrorAnalysis();
        });
        
        // ç¡®ä¿plotDataå‡½æ•°æ­£ç¡®å®šä¹‰
        function plotData() {
            if (!window.basicChart) {
                initBasicAnalysis();
            }
            
            // è·å–åˆ†ææ•°æ®
            const data = window.analysisData;
            if (!data) {
                console.error("æ²¡æœ‰å¯ç”¨çš„åˆ†ææ•°æ®");
                return;
            }
            
            // æ›´æ–°åŸºç¡€åˆ†æå›¾è¡¨
            window.basicChart.data.datasets = [
                {
                    label: 'ä»¿çœŸé‡‡é›†æ•°æ®',
                    data: data.measuredData,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointRadius: 5
                },
                {
                    label: 'æ¨¡å‹é¢„æµ‹',
                    data: data.modelPredictData,
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    pointRadius: 5
                }
            ];
            
            window.basicChart.update();
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            const dataCount = data.measuredData.length;
            const fitSlope = data.regression.slope;
            const calcRadius = data.R_predicted;
            const precision = 100 - ((Math.abs(data.R_predicted - data.R_actual) / data.R_actual) * 100);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateBasicStats({
                dataCount,
                fitSlope,
                calcRadius,
                precision
            });
        }
        
        function showDataLoadedToast() {
            const toast = document.createElement('div');
            toast.textContent = 'å·²æˆåŠŸä»ä»¿çœŸå®éªŒåŠ è½½æ•°æ®ï¼';
            toast.style.position = 'fixed';
            toast.style.top = '20px';
            toast.style.right = '20px';
            toast.style.backgroundColor = '#4CAF50';
            toast.style.color = 'white';
            toast.style.padding = '15px';
            toast.style.borderRadius = '5px';
            toast.style.zIndex = '1000';
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.5s ease';
            
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '1';
            }, 100);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 500);
            }, 3000);
        }
        
        // åŸºç¡€åˆ†æåŠŸèƒ½
        function initBasicAnalysis() {
            const chartCanvas = document.getElementById('basic-chart');
            if (!chartCanvas) return;
            
            // æ¸…é™¤å·²æœ‰å›¾è¡¨
            const existingChart = Chart.getChart(chartCanvas);
            if (existingChart) {
                existingChart.destroy();
            }
            
            // åˆ›å»ºç©ºå›¾è¡¨
            window.basicChart = new Chart(chartCanvas.getContext('2d'), {
                type: 'scatter',
                data: {
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç‰›é¡¿ç¯æ•°æ®åˆ†æ',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ç¯åº (m)'
                            },
                            type: 'linear'
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç¯å¾„å¹³æ–¹ (DÂ²â‚˜, mmÂ²)'
                            },
                            type: 'linear'
                        }
                    }
                }
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
            updateBasicStats({
                dataCount: 0,
                fitSlope: 0,
                calcRadius: 0,
                precision: 0
            });
        }
        
        function updateBasicStats(stats) {
            document.getElementById('data-count').textContent = stats.dataCount;
            document.getElementById('basic-fit-slope').textContent = stats.fitSlope ? `${stats.fitSlope.toExponential(4)} mmÂ²/ç¯` : '-- mmÂ²/ç¯';
            document.getElementById('calc-radius').textContent = stats.calcRadius ? `${stats.calcRadius.toFixed(2)} mm` : '-- mm';
            document.getElementById('measure-precision').textContent = stats.precision ? `${stats.precision.toFixed(2)}%` : '--%';
        }
        
        // åŠå¾„åˆ†æåŠŸèƒ½
        function initRadiusAnalysis() {
            const chartCanvas = document.getElementById('radius-chart');
            if (!chartCanvas) return;
            
            // æ¸…é™¤å·²æœ‰å›¾è¡¨
            const existingChart = Chart.getChart(chartCanvas);
            if (existingChart) {
                existingChart.destroy();
            }
            
            // åˆ›å»ºåŠå¾„åˆ†æå›¾è¡¨
            window.radiusChart = new Chart(chartCanvas.getContext('2d'), {
                type: 'line',
                data: {
                    labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                    datasets: [
                        {
                            label: 'R=100mm',
                            data: [],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'R=150mm',
                            data: [],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderWidth: 2,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸åŒæ›²ç‡åŠå¾„ä¸‹çš„ç‰›é¡¿ç¯ç›´å¾„å¯¹æ¯”',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ç¯åº'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç¯ç›´å¾„ (mm)'
                            }
                        }
                    }
                }
            });
            
            // é»˜è®¤åº”ç”¨å½“å‰æ»‘å—çš„åŠå¾„å€¼
            const radiusSlider = document.getElementById('radius-slider');
            if (radiusSlider) {
                updateRadiusAnalysis(parseFloat(radiusSlider.value));
            }
        }
        
        function updateRadiusAnalysis(radius) {
            if (!window.radiusChart) {
                initRadiusAnalysis();
            }
            
            // æ³¢é•¿ï¼Œå•ä½ï¼šm
            const wavelength = 589e-9;
            
            // æ›²ç‡åŠå¾„ï¼Œå•ä½ï¼šm
            const R = radius / 1000;
            
            // è®¡ç®—ä¸åŒç¯åºä¸‹çš„ç¯ç›´å¾„
            const data = [];
            for (let m = 1; m <= 10; m++) {
                const diameter = 2 * Math.sqrt(m * wavelength * R);
                data.push(diameter * 1000); // è½¬ä¸ºmm
            }
            
            // æ›´æ–°å›¾è¡¨
            window.radiusChart.data.datasets[0].data = data;
            window.radiusChart.data.datasets[0].label = `R=${radius}mm`;
            window.radiusChart.update();
            
            // æ›´æ–°ç¯æ•°é¢„ä¼°å’Œç›´å¾„é¢„ä¼°
            const ringCount = Math.floor(Math.sqrt(15 / (wavelength * R))) || 0;
            document.getElementById('ring-count').textContent = ringCount;
            
            const ring5Diameter = 2 * Math.sqrt(5 * wavelength * R) * 1000; // ç¬¬5ç¯ç›´å¾„ï¼Œå•ä½mm
            document.getElementById('ring-diameter').textContent = `${ring5Diameter.toFixed(2)} mm`;
        }
        
        // æ³¢é•¿åˆ†æåŠŸèƒ½
        function initWavelengthAnalysis() {
            const chartCanvas = document.getElementById('wavelength-chart');
            if (!chartCanvas) return;
            
            // æ¸…é™¤å·²æœ‰å›¾è¡¨
            const existingChart = Chart.getChart(chartCanvas);
            if (existingChart) {
                existingChart.destroy();
            }
            
            // åˆ›å»ºæ³¢é•¿åˆ†æå›¾è¡¨
            window.wavelengthChart = new Chart(chartCanvas.getContext('2d'), {
                type: 'line',
                data: {
                    labels: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸åŒæ³¢é•¿ä¸‹çš„ç‰›é¡¿ç¯ç›´å¾„å¯¹æ¯”',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ç¯åº'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç¯ç›´å¾„ (mm)'
                            }
                        }
                    }
                }
            });
            
            // é»˜è®¤æ˜¾ç¤ºé»„å…‰(589nm)çš„æ³¢é•¿åˆ†æ
            updateWavelengthAnalysis(589);
        }
        
        function updateWavelengthAnalysis(wavelength) {
            if (!window.wavelengthChart) {
                initWavelengthAnalysis();
            }
            
            // æ³¢é•¿ï¼Œå•ä½ï¼šm
            const lambda = wavelength * 1e-9;
            
            // æ›²ç‡åŠå¾„é»˜è®¤100mmï¼Œå•ä½ï¼šm
            const R = 100 / 1000;
            
            // è®¡ç®—ä¸åŒç¯åºä¸‹çš„ç¯ç›´å¾„
            const data = [];
            for (let m = 1; m <= 10; m++) {
                const diameter = 2 * Math.sqrt(m * lambda * R);
                data.push(diameter * 1000); // è½¬ä¸ºmm
            }
            
            // æ ¹æ®æ³¢é•¿è·å–é¢œè‰²
            let color;
            switch(wavelength) {
                case 450:
                    color = 'rgba(0, 0, 255, 0.7)';
                    break;
                case 550:
                    color = 'rgba(0, 255, 0, 0.7)';
                    break;
                case 589:
                    color = 'rgba(255, 215, 0, 0.7)';
                    break;
                case 650:
                    color = 'rgba(255, 0, 0, 0.7)';
                    break;
                default:
                    color = 'rgba(128, 128, 128, 0.7)';
            }
            
            // æ›´æ–°å›¾è¡¨
            window.wavelengthChart.data.datasets = [{
                label: `${wavelength}nm`,
                data: data,
                borderColor: color,
                backgroundColor: color.replace('0.7', '0.2'),
                borderWidth: 2,
                fill: false
            }];
            window.wavelengthChart.update();
            
            // æ›´æ–°æ¯”è¾ƒè¡¨æ ¼
            updateWavelengthComparisonTable(wavelength);
        }
        
        function updateWavelengthComparisonTable(currentWavelength) {
            // é»˜è®¤æ›²ç‡åŠå¾„100mm
            const R = 100 / 1000;
            
            // è®¡ç®—æ‰€æœ‰æ³¢é•¿çš„ç›´å¾„æ•°æ®
            const wavelengths = [450, 550, 589, 650];
            
            wavelengths.forEach(wavelength => {
                const lambda = wavelength * 1e-9;
                
                // ç¬¬1ç¯ç›´å¾„
                const d1 = 2 * Math.sqrt(1 * lambda * R) * 1000;
                document.getElementById(`d1-${wavelength}`).textContent = `${d1.toFixed(2)} mm`;
                
                // ç¬¬5ç¯ç›´å¾„
                const d5 = 2 * Math.sqrt(5 * lambda * R) * 1000;
                document.getElementById(`d5-${wavelength}`).textContent = `${d5.toFixed(2)} mm`;
                
                // ç›¸å¯¹ç²¾åº¦ - æ³¢é•¿è¶ŠçŸ­ï¼Œç²¾åº¦è¶Šé«˜
                const baseline = 589; // ä»¥é»„å…‰ä¸ºåŸºå‡†
                const precision = (baseline / wavelength) * 100;
                
                // é«˜äº®å½“å‰é€‰ä¸­çš„æ³¢é•¿
                const precision_td = document.getElementById(`p-${wavelength}`);
                precision_td.textContent = `${precision.toFixed(1)}%`;
                
                if (wavelength === currentWavelength) {
                    const row = precision_td.parentNode;
                    row.style.backgroundColor = 'rgba(255, 255, 0, 0.1)';
                    row.style.fontWeight = 'bold';
                } else {
                    const row = precision_td.parentNode;
                    row.style.backgroundColor = '';
                    row.style.fontWeight = 'normal';
                }
            });
        }
        
        // è¯¯å·®åˆ†æåŠŸèƒ½
        function initErrorAnalysis() {
            const chartCanvas = document.getElementById('error-impact-chart');
            if (!chartCanvas) return;
            
            // æ¸…é™¤å·²æœ‰å›¾è¡¨
            const existingChart = Chart.getChart(chartCanvas);
            if (existingChart) {
                existingChart.destroy();
            }
            
            // åˆ›å»ºè¯¯å·®å½±å“å›¾è¡¨
            window.errorChart = new Chart(chartCanvas.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['æ— è¯¯å·®', 'æœ‰è¯¯å·®'],
                    datasets: [{
                        label: 'æ›²ç‡åŠå¾„æµ‹é‡å€¼ (mm)',
                        data: [100, 100],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(255, 99, 132, 0.6)'
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'è¯¯å·®å¯¹æµ‹é‡ç»“æœçš„å½±å“',
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 90,
                            max: 110,
                            title: {
                                display: true,
                                text: 'æ›²ç‡åŠå¾„ (mm)'
                            }
                        }
                    }
                }
            });
        }
        
        function calculateErrorEffect() {
            if (!window.errorChart) {
                initErrorAnalysis();
            }
            
            // è·å–è¯¯å·®ç±»å‹å’Œå¹…åº¦
            const errorType = document.getElementById('error-type-select').value;
            const errorMagnitude = parseFloat(document.getElementById('error-magnitude').value);
            
            // åŸºå‡†æ›²ç‡åŠå¾„
            const baseRadius = 100;
            
            // æ ¹æ®è¯¯å·®ç±»å‹è®¡ç®—å½±å“ç³»æ•°
            let impactFactor;
            switch(errorType) {
                case 'contact':
                    impactFactor = 1.2;
                    break;
                case 'surface':
                    impactFactor = 0.9;
                    break;
                case 'light':
                    impactFactor = 0.6;
                    break;
                case 'reading':
                    impactFactor = 0.4;
                    break;
                case 'judgment':
                    impactFactor = 0.25;
                    break;
                default:
                    impactFactor = 0.5;
            }
            
            // è®¡ç®—è¯¯å·®å½±å“
            const errorImpact = baseRadius * (errorMagnitude / 100) * impactFactor;
            
            // éšæœºå†³å®šè¯¯å·®æ–¹å‘
            const direction = Math.random() > 0.5 ? 1 : -1;
            
            // æœ‰è¯¯å·®çš„åŠå¾„å€¼
            const errorRadius = baseRadius + direction * errorImpact;
            
            // æ›´æ–°å›¾è¡¨
            window.errorChart.data.datasets[0].data = [baseRadius, errorRadius];
            window.errorChart.options.plugins.title.text = `è¯¯å·®å¯¹æ›²ç‡åŠå¾„æµ‹é‡çš„å½±å“ (${(errorRadius - baseRadius).toFixed(2)} mm)`;
            
            // æ›´æ–°yè½´èŒƒå›´ï¼Œç¡®ä¿ä¸¤ä¸ªæŸ±çŠ¶å›¾éƒ½å¯è§
            const minY = Math.min(baseRadius, errorRadius) * 0.95;
            const maxY = Math.max(baseRadius, errorRadius) * 1.05;
            window.errorChart.options.scales.y.min = minY;
            window.errorChart.options.scales.y.max = maxY;
            
            window.errorChart.update();
            
            // æ›´æ–°è¯¯å·®å½±å“è¡¨æ ¼
            updateErrorImpactTable(errorType, Math.abs(errorImpact));
        }
        
        function updateErrorImpactTable(selectedType, errorImpact) {
            // è¯¯å·®ç±»å‹ä¸è¡¨æ ¼IDæ˜ å°„
            const typeIds = {
                'contact': { impact: 'contact-impact', relative: 'contact-relative' },
                'surface': { impact: 'surface-impact', relative: 'surface-relative' },
                'light': { impact: 'light-impact', relative: 'light-relative' },
                'reading': { impact: 'reading-impact', relative: 'reading-relative' },
                'judgment': { impact: 'judgment-impact', relative: 'judgment-relative' }
            };
            
            // åŸºå‡†åŠå¾„
            const baseRadius = 100;
            
            // æ›´æ–°æ‰€æœ‰è¯¯å·®ç±»å‹çš„è¡¨æ ¼è¡Œ
            Object.keys(typeIds).forEach(type => {
                const impactElem = document.getElementById(typeIds[type].impact);
                const relativeElem = document.getElementById(typeIds[type].relative);
                
                if (impactElem && relativeElem) {
                    // é«˜äº®å½“å‰é€‰ä¸­çš„è¯¯å·®ç±»å‹
                    if (type === selectedType) {
                        // æ›´æ–°å¹¶é«˜äº®é€‰ä¸­çš„è¯¯å·®ç±»å‹
                        impactElem.textContent = `Â±${errorImpact.toFixed(1)} mm`;
                        impactElem.style.fontWeight = 'bold';
                        impactElem.style.color = '#ff6b6b';
                        
                        const relativeError = (errorImpact / baseRadius * 100).toFixed(1);
                        relativeElem.textContent = `${relativeError}%`;
                        relativeElem.style.fontWeight = 'bold';
                        relativeElem.style.color = '#ff6b6b';
                    } else {
                        // æ¢å¤å…¶ä»–è¯¯å·®ç±»å‹çš„é»˜è®¤æ ·å¼
                        impactElem.style.fontWeight = 'normal';
                        impactElem.style.color = '';
                        
                        relativeElem.style.fontWeight = 'normal';
                        relativeElem.style.color = '';
                    }
                }
            });
        }

        // ä¸Šåˆ’æŒ‰é’®åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const scrollToTopBtn = document.getElementById('scrollToTop');
            if (!scrollToTopBtn) return;
            
            // æ»šåŠ¨äº‹ä»¶ç›‘å¬
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    scrollToTopBtn.classList.add('visible');
                } else {
                    scrollToTopBtn.classList.remove('visible');
                }
            });
            
            // ç‚¹å‡»äº‹ä»¶
            scrollToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html> 